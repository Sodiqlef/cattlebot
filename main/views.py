import time

from django.shortcuts import render
from django.http import JsonResponse
from nltk.tokenize import word_tokenize
from nltk.stem import WordNetLemmatizer
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity

# Sample knowledge base data
knowledge_base = [
    'Cattle manure can be converted into biogas through anaerobic digestion, providing a renewable energy source.', 'Cattle feedlots are used to finish cattle before slaughter, providing them with a high-energy diet to enhance meat quality.', 'Cattle farming can have both extensive (grazing) and intensive (feedlots) practices.', 'Cattle dung is used as organic fertilizer, benefiting soil health and agricultural productivity.', 'Cattle herds with a high percentage of body condition scores have better reproductive success.', 'Cattle are often given names and treated as individual personalities by their owners.', 'Cattle are often raised for their meat, which is a primary source of protein for many people.', "The color of a cow's hide can range from black and brown to white and even spotted.", 'Cattle are often dehorned to prevent injuries and enhance handling safety, and castration is performed to manage herd dynamics.', 'Vaccination is an essential aspect of cattle health management to prevent diseases like blackleg, brucellosis, and bovine viral diarrhea.', 'Colostrum, the first milk produced by the cow after calving, is rich in antibodies and vital for calf immunity.', 'Cattle are excellent swimmers and can cross rivers and streams.', 'Cattle handling and training techniques focus on building trust and minimizing stress to improve animal welfare.', 'Cattle have been depicted in art and mythology throughout history.', 'Cattle are essential for the production of leather and other byproducts.', 'Cattle farming has undergone significant changes with advancements in technology.', 'Cattle are sensitive to changes in their environment and can exhibit stress-related behavior.', 'Cattle were first brought to the Americas by Christopher Columbus on his second voyage in 1493.', 'Cattle can be used in sustainable agricultural practices to improve soil fertility.', 'Cattle ranching is a significant driver of deforestation in some regions.', 'Cattle are an important part of sustainable agriculture.', 'Calves are baby cattle.', 'Cattle have a specialized organ called the rumen to digest cellulose.', 'Cattle have been depicted in art and literature throughout history.', 'Cattle have a unique pattern of noseprints, much like human fingerprints.', 'There are different breeds of cattle, each with distinct characteristics and purposes. Some cattle breeds are specifically bred for meat production, while others are bred for milk and dairy products. Dual-purpose breeds can be used for both meat and milk production.', 'Cattle are ruminants, meaning they chew cud to aid in digestion.', 'The average lifespan of cattle is around 15 to 20 years.', 'Cattle diseases, such as tuberculosis and brucellosis, can have severe economic impacts on the industry and public health.', 'Cattle can suffer from nutritional deficiencies if their diet lacks essential minerals like selenium and zinc.', 'Cattle contribute to greenhouse gas emissions, particularly methane, due to their digestive system.', 'Cattle farming can have environmental impacts, such as water pollution from manure runoff.', 'The One Health approach recognizes the interconnection between cattle health, human health, and environmental well-being.', 'There are more than 1 billion cattle in the world.', 'Cattle are vulnerable to certain diseases, which can impact their productivity.', 'Cattle are ruminant animals, possessing a four-compartment stomach that allows them to digest fibrous plant material.', 'Cattle are domesticated ungulates, commonly raised for meat and milk production.', 'Cattle have an acute sense of smell, which they use for detecting food and recognizing other individuals.', "High-stress handling of cattle can lead to 'Dark-Cutters,' a condition that affects meat quality.", 'Cattle are often raised on pasture or in feedlots for meat production.', 'Cattle can have different coat colors and patterns, making each one unique.', 'Cattle can recognize and remember individual humans.', 'Cattle are susceptible to various health issues, including respiratory infections, gastrointestinal disorders, and metabolic diseases.', 'Cattle have a keen sense of smell and can detect scents from long distances.', 'Cattle are known for their resilience and adaptability to various environments.', 'Cattle herding is an ancient practice that has been passed down through generations.', 'Cattle have a hierarchical social structure within their herds.', 'Cattle can form strong bonds with their human handlers.', 'Cattle play a crucial role in sustainable agriculture, helping maintain soil fertility through their grazing habits.', 'Cattle must be protected from extreme weather conditions, as frostbite can affect their extremities.', 'Cattle can be trained to follow certain commands and perform specific tasks.', 'Cattle are an essential part of the economy in many agricultural societies.', 'Cattle are used in some places for their draught power, pulling plows and carts.', 'Cattle are affected by various diseases and parasites, requiring proper healthcare.', 'Cattle are domesticated ruminant animals, typically raised as livestock for meat and dairy products.', 'Cattle are an essential part of the ecosystem in many grassland regions.', 'Cattle have played a crucial role in shaping the landscape of many regions.', 'Cattle have a strong sense of smell and can detect odors from several miles away.', 'Cattle are usually docile animals, but they can become aggressive if provoked.', 'Controlled breeding programs are used to manage calving seasons and optimize herd size.', 'Cattle undergo a gestation period of approximately nine months, and proper prenatal care is crucial for calf health.', 'Proper ventilation and temperature control in barns and shelters are essential for cattle health.', 'Cattle communicate through a series of vocalizations, body language, and scent signals.', 'Cattle have been selectively bred to enhance certain traits.', 'Cattle are herbivores and mainly consume grass and other plant materials.', 'Bulls are male cattle used for breeding purposes.', 'Cattle farming practices vary based on cultural and regional traditions.', 'Proper waste management in cattle operations helps prevent environmental contamination and maintains herd health.', 'Good stockmanship and low-stress handling techniques are essential in minimizing cattle stress and improving productivity.', 'The Brahman breed is known for its tolerance to heat and disease resistance.', 'Cattle farming has evolved over centuries, with modern techniques focused on efficiency and sustainability.', 'Cattle behavior and body language can indicate signs of pain or discomfort, requiring prompt attention.', 'Heat detection aids, such as tail chalks and mount detectors, can be used to identify cows in estrus.', 'Proper hygiene and sanitation practices in cattle facilities can prevent disease outbreaks and improve overall herd health.', 'Parasites, such as internal worms and external ticks, can negatively impact cattle health and productivity if not managed.', 'The process of weaning separates calves from their mothers, marking a critical stage in their development.', 'Cattle should have access to clean water and shelter to maintain their well-being and performance.', 'A group of cattle is called a herd.', 'Cattle have played an important role in human history and civilization.', 'Cattle behavior can indicate their health status; signs of lameness or decreased appetite may signal underlying issues.', 'Pregnancy diagnosis in cattle can be done through palpation or ultrasound techniques.', 'The Global Roundtable for Sustainable Beef (GRSB) works to improve the sustainability of the beef value chain.', 'Cattle can produce methane gas during digestion, contributing to global warming.', 'Cattle have a unique four-chambered stomach for efficient digestion.', 'Cattle can be trained to respond to commands and perform various tasks.', 'Universities and agricultural extension programs offer courses and resources to educate cattle farmers on efficient management practices.', 'Foot Rot is a painful bacterial infection that can affect the hooves of cattle if proper hoof care is not maintained.', 'Cattle have a complex digestive system that allows them to extract nutrients from fibrous plants.', 'Cattle can recognize individual members of their herd.', 'Cattle have a unique digestive system that allows them to break down tough plant materials.', 'Cattle can suffer from various diseases, such as foot and mouth disease.', 'Cattle ranchers and farmers are embracing sustainable practices, such as regenerative agriculture, to promote environmental health.', 'Cattle are used in some cultures for traditional ceremonies and rituals.', 'Cattle are sometimes used in therapy programs for their calming effect on humans.', 'Cattle have been used for their strength and stamina in agricultural work.', 'Artificial Lighting Programs can manipulate the photoperiod to increase milk production in dairy cows.', 'Cattle herding is an important cultural practice in some societies.', 'Cattle are known for their calm and gentle demeanor.', 'Beef Quality Assurance (BQA) programs provide guidelines for responsible and ethical cattle management practices.', 'Cattle have a wide field of vision of nearly 360 degrees.', 'Cattle farming is a significant source of income for many rural communities.', 'Cattle are known for their ability to thrive in diverse climates and landscapes.', 'Cattle have played a vital role in the development of human societies.', 'Cattle have been used in warfare throughout history.',
    'Breeding soundness examinations are conducted on bulls to ensure their reproductive fitness before breeding.', 'Ethical considerations are becoming increasingly important in cattle farming, with emphasis on animal welfare and sustainable practices.', 'Cattle can have different vocalizations for different purposes, such as calling their calves or expressing distress.', 'Cattle farming is an important part of sustainable agriculture.', 'Angus cattle are popular for their marbled beef and excellent meat quality.', 'Cattle are used in some cultures for ceremonial purposes and as symbols of wealth.', 'Cattle have a keen sense of hearing and can detect sounds from long distances.', "The 'Maternal Effect' refers to the influence of the cow's genetics on the growth and development of her calf.", 'Cattle handling facilities, like chutes and corrals, are designed to minimize stress during vaccinations and other procedures.', 'Cattle are social animals and prefer to live in groups.', 'Beef is the most widely consumed meat worldwide, coming from cattle.', 'Bovine Somatotropin (BST) is a naturally occurring hormone that can enhance milk production in dairy cows.', 'Genetic testing and genomic selection tools enable cattle farmers to make informed breeding decisions.', 'Cattle can be used as working animals for tasks like plowing fields.', 'Cattle can be trained to respond to commands and interact with humans.', 'Cattle have a natural herding instinct.', 'Cattle have been a symbol of wealth and status in some cultures.', 'Cattle have social hierarchies within their herds, with dominant and subordinate individuals.', 'Crossbreeding can improve hybrid vigor in cattle, resulting in healthier and more robust offspring.', 'Cows have an excellent sense of smell and can detect scents up to 6 miles away.', 'Cattle are social animals and form strong bonds within their herds.', 'Artificial insemination (AI) is a widely used reproductive technique in cattle breeding to improve genetics and traits.', 'Cattle have been bred to have various physical attributes, depending on their intended use.', 'Cattle have been domesticated for over 10,000 years.', 'In vitro fertilization (IVF) and embryo transfer techniques are used to accelerate genetic progress in cattle breeding.', 'Cattle require routine hoof trimming and maintenance to prevent lameness and discomfort.', 'Modern technologies, such as RFID ear tags and electronic monitoring systems, enable better cattle management and tracking.', 'Cow dung is used as a source of fuel and fertilizer in some cultures.', 'The first stomach chamber of cattle, the rumen, can hold up to 50 gallons of partially digested food.', 'Different cattle breeds have distinct characteristics, such as size, color, and temperament.', 'Copper deficiency can lead to various health issues in cattle, such as anemia and joint problems.', 'Cattle are essential for the production of dairy products like milk, cheese, and yogurt.', 'Cattle farming contributes to biodiversity conservation by preserving natural grasslands and ecosystems.', 'Some cattle breeds are better suited for meat production, while others excel in milk production or dual-purpose roles.', 'Cattle contribute significantly to the economy of many countries.', 'Cattle grazing patterns can influence plant diversity and ecosystem health in rangeland and grassland ecosystems.', 'Cattle have a unique digestive system that allows them to extract nutrients from plants.', 'Cattle have a strong sense of smell, which they use to detect danger.', 'Cattle contribute to greenhouse gas emissions, and research is ongoing to find ways to reduce their environmental impact.', 'Cattle ranching and pastoralism have been essential to the livelihoods of many cultures and communities for centuries.', 'Cattle are social animals and often live in herds, with a social hierarchy and strong bonds between individuals. They communicate with each other through vocalizations, body language, and other means.', 'Cattle communicate with each other through a variety of vocalizations and body language.', 'Cattle farming practices vary widely depending on cultural and regional traditions.', 'Cattle have a natural instinct to graze and can consume large amounts of vegetation.', 'Cattle have a relatively slow heart rate compared to other animals.', 'Cattle can tolerate a wide range of temperatures, from very cold to extremely hot.', 'Regular veterinary check-ups are essential to monitor cattle health and address any emerging issues promptly.', 'Cattle can be raised in a variety of environments, from open pasture to feedlots.', 'Cattle can be used to control vegetation in some areas.', 'Cattle are an important source of income and livelihood for many farmers.', 'In some countries, cattle are considered sacred and have religious significance.', 'Cattle have been an integral part of human civilization for thousands of years.', 'Cattle have a unique system of social hierarchy within their herds.', 'Bovine Respiratory Disease (BRD) is a common and costly condition affecting cattle, often caused by viruses and bacteria.', 'Cattle, also known as cows, are domesticated ungulate animals that belong to the genus Bos. They are large, herbivorous mammals that are primarily raised for their meat, milk, and other products. Cattle have been domesticated for thousands of years and play a vital role in agriculture and food production worldwide.', 'Cattle have been used for transportation and plowing fields.', 'Cattle are used in some cultures for traditional sports and competitions.', 'Cattle have been used for centuries in agriculture and transportation.', 'Cattle in intensive production systems may be prone to stress-induced diseases like Bovine Ulcerative Stomatitis.', 'Cattle can suffer from various health issues, including Bovine Respiratory Disease (BRD) and Foot-and-Mouth Disease (FMD).', 'Cattle were first domesticated in the Neolithic era, around 10,000 years ago.', "The concept of 'grass-fed' beef emphasizes the natural diet of cattle and its potential health benefits.", 'Cattle are often used for research in various fields of biology and medicine.', "Cow's milk contains lactose, a sugar that can cause lactose intolerance in some humans.", 'Cattle farmers often use genetic selection to breed animals with desirable traits, such as high milk production or meat quality.', 'Cattle are known for their strong maternal instincts and protective behavior towards their young.', 'Remote sensing and precision agriculture technologies are used to monitor cattle health and pasture conditions.', 'Cattle farming is a significant industry in many countries.', 'Throughout history, cattle have been significant to human societies, providing essential resources like meat, milk, leather, and other by-products. They are an integral part of agriculture and contribute to food security and livelihoods in many parts of the world.', 'Cattle are ruminant animals, meaning they have a unique four-compartment stomach that allows them to digest fibrous plant material effectively. They graze on grass and other vegetation and have a natural ability to convert plant matter into energy-rich products like milk and meat.', 'Cattle can have different coat colors and patterns, which can be used for identification.', 'Cattle were first brought to the Americas by European explorers.', 'Cattle are herbivores and primarily feed on grass and other vegetation.', 'Proper nutrition and balanced diet are crucial for cattle health, ensuring they get adequate vitamins, minerals, and nutrients.', 'The horns of cattle are made of keratin, the same material as human fingernails.', 'Cattle can display a wide range of behaviors and emotions.', 'Cattle can be trained to respond to their names.', 'Continuous education and training are crucial for cattle farmers to stay updated on best practices, new technologies, and regulations.', 'Managed grazing and rotational grazing systems can optimize pasture utilization and support sustainable cattle production.', 'Cattle are an essential part of many traditional agricultural systems.', 'Cows are female cattle that have given birth to at least one calf.', 'Cattle can suffer from heat stress during hot weather, leading to reduced feed intake and decreased milk production.', 'Proper biosecurity measures are essential to prevent the introduction and spread of infectious diseases in cattle herds.', 'Cattle can sleep while standing up or lying down.', 'Cattle have a strong maternal instinct and form close bonds with their offspring.', 'Some cattle breeds, like the Brahman, are more heat-tolerant and better suited for tropical climates.', 'Cattle can suffer from heat stress during hot weather.', 'Estrus synchronization is practiced to control breeding seasons and optimize reproductive efficiency in cattle herds.', 'Jersey cattle are known for their high butterfat content in their milk.', 'Cows produce milk for their calves and humans, containing essential nutrients like calcium and protein.', 'Cattle have a unique digestive system that allows them to digest cellulose.', 'Cattle have been bred for various purposes, including meat, milk, and labor.', 'The scientific name for cattle is Bos taurus.', 'Cattle have a well-developed sense of hearing.', 'Cattle can suffer from various diseases, such as bovine respiratory disease and foot rot.', 'Cattle vocalizations can convey information about their well-being and state of mind.', 'Cattle have a strong herd instinct and will often stay close together for safety.']

# Preprocess the knowledge base data
lemmatizer = WordNetLemmatizer()
preprocessed_data = []
for sentence in knowledge_base:
    tokens = word_tokenize(sentence.lower())
    lemmatized_tokens = [lemmatizer.lemmatize(token) for token in tokens]
    preprocessed_data.append(" ".join(lemmatized_tokens))

# Vectorize the preprocessed data
vectorizer = TfidfVectorizer()
knowledge_base_vectors = vectorizer.fit_transform(preprocessed_data)

# Function to generate a response given a user query


def generate_response(query):
    preprocessed_query = " ".join([lemmatizer.lemmatize(
        token) for token in word_tokenize(query.lower())])
    query_vector = vectorizer.transform([preprocessed_query])

    similarity_scores = cosine_similarity(
        query_vector, knowledge_base_vectors).flatten()
    most_similar_index = similarity_scores.argmax()

    if similarity_scores[most_similar_index] > 0:
        return knowledge_base[most_similar_index]
    else:
        return "I'm sorry, I don't have information on that topic."

# Django view function to handle requests to the root URL (http://localhost:8000/)


def home(request):
    if request.method == 'POST':
        user_query = request.POST.get("user_query")
        response = generate_response(user_query)
    else:
        response = "Hi, welcome to CattleBot! Go ahead and send me a message. 😄"
    print(response)

    return render(request, "index.html", {"response": response})

# Django view function to handle requests to http://localhost:8000/get/


def get_response(request):
    if request.method == 'GET':
        user_query = request.GET.get("msg")
        response = generate_response(user_query)
        return JsonResponse({'response': response})
    else:
        return JsonResponse({'error': 'Invalid request method'}, status=400)
